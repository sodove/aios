# AIOS MVP — Отчёт
Дата: 2026-02-21

## Описание задачи
Создание минимальной ОС (AIOS) на базе Debian Linux с единственным интерфейсом: чат с ИИ + Chromium браузер. Написана на Rust с Iced GUI, Unix IPC, поддержкой Claude/OpenAI/Ollama.

## Итоги Research (консилиум)
6 параллельных экспертов: Архитектор, UI/UX дизайнер, Frontend-эксперт, Безопасность, DevOps, API-дизайнер. Сводка: Выбран Debian Bookworm + live-build, Rust с Iced 0.14 для GUI, Unix domain sockets для IPC, star-topology через aios-agent, MCP tool framework, OOBE first-boot wizard.

## План реализации
21 шаг в 6 батчах:
- Batch 0: Workspace setup, scaffold crates, Docker environment, CI
- Batch 1: aios-agent skeleton, LLM providers (Claude/OpenAI/Ollama)
- Batch 2: aios-chat Iced UI, Markdown rendering, E2E text chat via IPC
- Batch 3: MCP tool framework (19 tools), aios-confirm dialog, tool execution pipeline, tool cards in chat
- Batch 4: aios-dock panel, Chrome MCP bridge (7 browser tools), sway/chromium ISO config
- Batch 5: Cross-compilation, OOBE wizard, final ISO build

## Что реализовано

### Workspace (8 crates)
- `aios-common` — общие типы, IPC протокол (length-prefixed JSON), конфигурация
- `aios-agent` — центральный агент, agentic loop (10 итераций max), LLM провайдеры, rate limiter, audit log
- `aios-chat` — GUI чат на Iced 0.14 с Markdown, tool cards, OOBE wizard
- `aios-dock` — панель задач (Iced, 2 кнопки: Chat/Browser)
- `aios-confirm` — диалог подтверждения для деструктивных действий
- `aios-mcp` — MCP tool registry (19 tools: файлы, shell, процессы, браузер)
- `aios-memory` — (scaffold, excluded from ISO)
- `aios-voice` — (scaffold, excluded from ISO)

### ISO/Distro
- Debian Bookworm (stable) + live-build в Docker
- sway (Wayland compositor) + greetd (auto-login)
- Chromium + pipewire audio
- 4 бинарника: aios-agent, aios-chat, aios-dock, aios-confirm
- systemd user services с aios.target
- Docker cross-compilation на Apple Silicon (--platform linux/amd64)

### Ключевые архитектурные решения
- Star topology: все процессы общаются только через aios-agent
- TrustRequirement (None/Confirm/DoubleConfirm) для MCP tools
- aios-confirm — отдельный процесс (агент не может сам подтвердить)
- Sliding window rate limiter для деструктивных операций
- OOBE wizard (4 шага) при первом запуске

## Результаты Validation

Платформа: Docker (ISO build smoke-test)

| Шаг | Описание | Статус |
|-----|----------|--------|
| 1 | `cargo build --workspace` | PASS |
| 2 | `cargo clippy --workspace` 0 warnings | PASS |
| 3 | `cargo test --workspace` 5 tests | PASS |
| 4 | `make build-linux` cross-compilation | PASS |
| 5 | `make install-binaries` (4 бинарника, ~80MB) | PASS |
| 6 | `make build-iso` (live-build в Docker) | PASS |
| 7 | ISO файл 974MB в output/ | PASS |

## Проблемы и откаты

### Проблема 1: grub-efi-amd64-bin на ARM64
- **Описание**: Docker на Apple Silicon тянул arm64 образ, а grub-efi-amd64-bin доступен только для x86_64
- **Решение**: Добавлен `--platform linux/amd64` в Makefile для build-iso

### Проблема 2: live-build использовал bullseye вместо bookworm
- **Описание**: `auto/config` скрипт был внутри `config/auto/config`, а live-build ищет в `auto/config` (корень working directory)
- **Решение**: Dockerfile копирует `auto/` на верхний уровень; build-iso.sh тоже дублирует

### Проблема 3: labwc отсутствует в Debian bookworm
- **Описание**: labwc доступен только в Debian sid/trixie, не в bookworm stable
- **Решение**: Заменён на sway (tiling WM, доступен в bookworm), конфиги переписаны

### Проблема 4: Нехватка места на Docker overlay FS
- **Описание**: xorriso падал с "Image size exceeds free space on media" — контейнер overlay забит chroot-ом
- **Решение**: Workspace вынесен на Docker named volume (`aios-iso-work`); docker system prune освободил 42GB

## Статус: Done

ISO образ AIOS (974MB) успешно собирается из исходников через `make all`. Готов к загрузке в QEMU или на реальное железо.
